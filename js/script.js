app.payments={last_timeout:3111,price_timeout:void 0,last:function(){var e=$("#drop-id-copy").html(),t=$(".drops > .drop-list > .drop-id:first-child");return app.request("/?payments/last/",{id:t.attr("data-payment-id"),key:t.attr("data-token")},(function(t){setTimeout((function(){app.payments.last()}),app.payments.last_timeout),t.type&&($.isEmptyObject(t.data)||(e=(e=(e=(e=(e=(e=(e=(e=e.replace(/\{ITEM_ID\}/g,t.data.id)).replace(/\{ITEM_TOKEN\}/g,t.data.token)).replace(/\{ITEM_IMAGE\}/g,t.data.image)).replace(/\{ITEM_TITLE\}/g,t.data.title)).replace(/\{PAYMENT_ID\}/g,t.data.payment_id)).replace(/\{PAYMENT_PLAYER\}/g,t.data.payment_player)).replace(/\{PAYMENT_DATE\}/g,t.data.payment_date)).replace(/\{PAYMENT_TIMING\}/g,t.data.payment_timing),$(".drops > .drop-list").prepend(e),$(".drops > .drop-list > .drop-id:first-child").attr("data-wow-duration","0.6s").addClass("wow animate__animated animate__fadeInLeft"),$(".drops > .drop-list > .drop-id:nth-child(n+7)").remove()))}),(function(e){console.log(e),setTimeout((function(){app.payments.last()}),app.payments.last_timeout)}))},price:function(e){void 0!==app.payments.price_timeout&&clearTimeout(app.payments.price_timeout),e.prop("disabled",!0);var t=e.closest("form");app.payments.price_timeout=setTimeout((function(){return app.request("/?payments/price/",app.getFormValues(t),(function(t){if(e.prop("disabled",!1),!t.type)return void 0!==t.errors?app.validator.errors(t.errors):pipui.alert.open(t.text,t.title);var i=$("#price"),a=$("#oldprice");i.text(t.data.price),t.data.clear!=t.data.price?a.text(t.data.clear+" ₽").show():a.text("0 ₽").hide()}),(function(t){console.log(t),e.prop("disabled",!1),pipui.alert.open("Произошла системна ошибка запроса. Обратитесь к администрации","Внимание!")}))}),300)},create:function(e){e.prop("disabled",!0);var t=e.closest("form");return app.request("/?payments/create/",app.getFormValues(t),(function(t){if(!t.type)return e.prop("disabled",!1),$('.modal[data-id="method"] .methods [type="button"]').prop("disabled",!1).removeClass("active"),pipui.alert.open(t.text,t.title);window.location.href=t.data.url}),(function(t){console.log(t),e.prop("disabled",!1),$('.modal[data-id="method"] .methods [type="button"]').prop("disabled",!1).removeClass("active"),pipui.alert.open("Произошла системна ошибка запроса. Обратитесь к администрации","Внимание!")}))}},app.items={sections:[],categories:[],items:[],stack:[],sectionsByID:{},categoriesBySectionID:{},itemsByCategoryID:{},itemsByID:{},selectedSection:{},selectedCategory:{},selectedItem:{},updateItems:function(){var e=this;this.items=items,this.categories=categories,this.sections=sections,$.each(this.sections,(function(t,i){e.sectionsByID[i.id]=i;var a={data:i,categories:[]};void 0===e.categoriesBySectionID[i.id]&&(e.categoriesBySectionID[i.id]=[]),$.each(e.categories,(function(t,s){if(s.section_id==i.id){e.categoriesBySectionID[i.id].push(s),void 0===e.itemsByCategoryID[s.id]&&(e.itemsByCategoryID[s.id]=[]);var r={data:s,items:[]};$.each(e.items,(function(t,i){i.category_id==s.id&&(e.itemsByID[i.id]=i,e.itemsByCategoryID[s.id].push(i),r.items.push(i))})),a.categories.push(r)}})),e.stack.push(a)})),this.renderSectionsSlider()},renderSectionsSlider:function(){var e=this,t=$(".sections-slider > .slider-links > .slider-links-wrapper");$.each(this.sections,(function(i,a){var s=$('<li class="slider-link">'+a.title+"</li>").attr("title",a.text).attr("data-section-id",a.id);0==i&&e.slider.select(s),t.append(s)}))},slider:{select:function(e){if(!e.hasClass("active")){e.siblings(".slider-link.active").removeClass("active"),e.addClass("active");var t=e.attr("data-section-id");$.each(app.items.stack,(function(e,i){if(i.data.id==t){app.items.selectedSection=i.data,app.customSelect.stack=i.categories;var a=i.categories[0];if(void 0===a)return!1;app.items.selectedCategory=a.data;var s=a.items[0];return void 0===s||(app.items.selectedItem=s),!1}})),app.customSelect.render()}}}},$((function(){$("body").on("mouseenter","#review-form .stars > .star",(function(){var e=$(this);e.addClass("hover");for(var t=$("#review-form .stars > .star"),i=t.index(e),a=0;a<i;a++)t.eq(a).addClass("hover")})).on("mouseleave","#review-form .stars > .star",(function(){$("#review-form .stars > .star").removeClass("hover")})).on("click",".sections-slider .slider-link",(function(e){e.preventDefault();var t=$(this);app.items.slider.select(t)})).on("change",'.custom-select[name="item_id"]',(function(){var e=$(this).val();app.items.selectedItem=app.items.itemsByID[e],$(".form-wrapper > .form-footer .price-wrapper > .price").text(app.items.selectedItem.price);var t=$(".form-wrapper > .form-footer .price-wrapper > .oldprice");app.items.selectedItem.oldprice>0?t.html(app.items.selectedItem.oldprice+" ₽").show():t.html("0 ₽").hide()})).on("change",'.custom-select[name="item_id"]',(function(){var e=$(".donate-info-wrapper"),t=app.items.selectedItem,i=t.image?t.image:"/uploads/template/img/camera-white.png";e.find(".item-image").css("background-image","url("+i+")"),e.find(".item-title").text(t.title),e.find(".item-price").text(t.price+" ₽");var a=e.find(".item-oldprice").text(t.oldprice+" ₽");t.oldprice>0?a.show():a.hide();var s=e.find(".item-regions"),r=e.find(".item-prefix");t.prefix?(r.find(".value").text(t.prefix),r.show()):r.hide(),t.regions>0?(s.find(".value").text(t.regions),s.show()):-1==t.regions?(s.find(".value").text("Бесконечны"),s.show()):s.hide();var o=e.find(".item-commands");if(t.commands.length<=0)o.hide();else{var p=o.find(".commands");p.empty(),$.each(t.commands,(function(e,t){var i=$('<li class="command-id"></li>'),a=$('<span class="command"></span>').text(t.value),s=$('<span class="text"></span>').text(t.text);i.append(a).append(s),p.append(i)})),o.show()}var n=e.find(".item-text"),d=n.find(".text");t.text?(d.html(t.text.replace(/\n/g,"<br>")),n.show()):(n.hide(),d.html("")),app.payments.price($(".mainslide.header .form-wrapper .form-submit"))})).on("input","#player, #promocode",(function(){app.payments.price($(".mainslide.header .form-wrapper .form-submit"))})).on("click",".mainslide.header .form-wrapper .form-submit",(function(e){e.preventDefault();var t=$(this);app.payments.create(t)})),$(document).on("contextmenu",(function(e){$(e.target).closest(".sections-slider").length>0&&(e.preventDefault(),e.stopPropagation())})),setTimeout((function(){app.items.updateItems()}),0)}));