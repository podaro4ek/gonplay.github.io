$((function(){$("body").on("submit","#review-form",(function(e){e.preventDefault();var t=$(this),a=t.find('[type="submit"]');a.prop("disabled",!0),grecaptcha.ready((function(){grecaptcha.execute(app.captcha,{action:"submit"}).then((function(e){var r=app.getFormValues(t);return r.append("captcha",e),app.request(t.attr("action"),r,(function(e){if(a.prop("disabled",!1),!e.type)return void 0!==e.errors?app.validator.errors(e.errors):pipui.alert.open(e.text,e.title);t.find('input[type="text"], textarea').val(""),t.fadeOut("fast",(function(){$("#review-success").fadeIn("fast")}))}),(function(e){a.prop("disabled",!1),pipui.alert.open("Не удалось получить данные. Возможно, сервер-обработчик недоступен","Ошибка!"),console.log(e)}))}))}))})).on("click","#review-form .stars > .star",(function(e){e.preventDefault();var t=$(this).find('[name="rating"]'),a=t.val(),r=$("#review-form .stars > .star");r.removeClass("active"),$('#review-form .stars > .star [name="rating"]').prop("checked",!1),r.each((function(){var e=$(this);if(e.addClass("active"),e.find('[name="rating"]').val()==a)return!1})),t.prop("checked",!0)})).on("click",".open-review-trigger",(function(e){e.preventDefault(),$(".review-form").fadeIn("fast")})).on("click",".review-form .close-trigger",(function(e){e.preventDefault(),$(this).closest(".review-form").fadeOut("fast")})).on("click",".reviews .close-trigger",(function(e){e.preventDefault(),$(this).closest(".review-success").fadeOut("fast")})).on("click",".show-more-reviews",(function(e){e.preventDefault();var t=$(".show-more-reviews");if(!t.hasClass(".disabled")){t.addClass("disabled");var a=parseInt(t.attr("data-page"));return app.request("/?reviews/load/page-"+a,{},(function(e){if(t.removeClass("disabled"),!e.type)return pipui.alert.open(e.text,e.title);var r=$("#reviews");$.each(e.data.list,(function(e,t){r.append(t)})),t.attr("data-page",a+1),e.data.count<=0&&t.hide()}),(function(e){t.removeClass("disabled"),pipui.alert.open("Не удалось получить данные. Возможно, сервер-обработчик недоступен","Ошибка!"),console.log(e)}))}})),$("html").on("click","body",(function(e){var t=$(e.target),a=$("#review-form"),r=$("#review-success");t.closest("#review-success").length||r.fadeOut("fast"),t.hasClass("open-review-trigger")||t.closest("#review-form").length||a.fadeOut("fast")}))}));